<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balance Stock Report</title>
    <link rel="icon" type="logoTH.png" href="logoTH.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- K2D Font -->
    <link href="https://fonts.googleapis.com/css2?family=K2D:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    
    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body {
            box-sizing: border-box;
            font-family: 'K2D', sans-serif;
        }
        
        /* DataTables Custom Styling */
        .dataTables_wrapper {
            font-family: 'K2D', sans-serif;
        }
        
        .dataTables_wrapper .dataTables_filter {
            margin-bottom: 10px; /* ‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        }

        .dataTables_filter input {
            border: 1px solid #00aeff;
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin-left: 0.5rem;
        }
        
        .dataTables_length select {
            border: 1px solid #00aeff;
            border-radius: 0.5rem;
            padding: 0.25rem;
            margin: 0 0.5rem;
        }
        
        table.dataTable thead th {
            background-color: #00a2ff !important;
            color: rgb(255, 255, 255) !important;
            border-bottom: none !important;
            text-align: center !important;
        }
        
        table.dataTable tbody tr:hover {
            background-color: #eff6ff !important;
        }
        
        .dataTables_paginate .paginate_button {
            padding: 0.5rem 0.75rem !important;
            margin: 0 0.125rem !important;
            border-radius: 0.375rem !important;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button.current,
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover,
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:active {
            background: #00a2ff !important;   /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏î‡∏á */
            color: #ffffff !important;        /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏î‡∏≥ */
            border: 1px solid #00a2ff !important;
        }

        .header-card {
            background: linear-gradient(90deg,  #10bbff,  #00c3ff);
            color: white !important;
        }
        .excel-button {
            background-color: #009b2e !important;
        }
    </style>
</head>
<body>
    <div class="container mx-auto py-6">
        <!-- Header -->
        <div class="header-card border border-slate-200 rounded-xl shadow-sm mb-6 p-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <img src="logo-crc.png" alt="CRC Logo" class="h-12 w-auto">
                    <div>
                        <h1 class="text-3xl font-bold">Balance Stock Report</h1>
                        <p class="text-slate-600">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</p>
                    </div>
                </div>
                <div class="text-right">
                    <button id="exportBtn" class="excel-button text-white px-6 py-2 rounded-xl font-medium transition-colors duration-100 flex items-center space-x-2 mb-2">
                        <i class="fas fa-file-excel"></i>
                        <span>Export</span>
                    </button>
                </div>
            </div>
        </div>
<div class="text-right p-4">
  <p class="text-sm text-slate-500">
    ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="lastUpdate"></span>
  </p>
</div>
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Weight Summary -->
            <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-6">
                <div class="flex items-center space-x-3 mb-4">
                    <i class="fas fa-weight-hanging text-blue-600 text-xl"></i>
                    <h2 class="text-xl font-semibold text-blue-800">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏° (‡∏ï‡∏±‡∏ô)</h2>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-600">Surin:</span>
                        <span id="weightSurin" class="text-2xl font-bold text-blue-600">0</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-600">Nangrong:</span>
                        <span id="weightNangrong" class="text-2xl font-bold text-blue-600">0</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-600">Det Udom:</span>
                        <span id="weightDetUdom" class="text-2xl font-bold text-blue-600">0</span>
                    </div>
                    <hr class="border-slate-200">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-slate-700">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span id="weightTotal" class="text-3xl font-bold text-blue-800">0</span>
                    </div>
                </div>
            </div>

            <!-- Cost Summary -->
            <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-6">
                <div class="flex items-center space-x-3 mb-4">
                    <i class="fas fa-coins text-blue-600 text-xl"></i>
                    <h2 class="text-xl font-semibold text-blue-800">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</h2>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-600">Surin:</span>
                        <span id="costSurin" class="text-2xl font-bold text-blue-600">0</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-600">Nangrong:</span>
                        <span id="costNangrong" class="text-2xl font-bold text-blue-600">0</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-600">Det Udom:</span>
                        <span id="costDetUdom" class="text-2xl font-bold text-blue-600">0</span>
                    </div>
                    <hr class="border-slate-200">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-slate-700">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span id="costTotal" class="text-3xl font-bold text-blue-800">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-6">
            <div class="flex items-center space-x-3 mb-6">
                <i class="fas fa-table text-blue-600 text-xl"></i>
                <h2 class="text-xl font-semibold text-blue-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏´‡∏•‡πá‡∏Å</h2>
            </div>
            
            <div class="overflow-x-auto">
                <table id="inventoryTable" class="display w-full">
                    <thead class="bg-slate-100 text-blue-800">
                        <tr>
                            <th>Group</th>
                            <th>Weight Surin</th>
                            <th>Weight Nangrong</th>
                            <th>Weight Det Udom</th>
                            <th>Cost Surin</th>
                            <th>Cost Nangrong</th>
                            <th>Cost Det Udom</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

<script src="app.js"></script>

<script>
const SHEET_IDLASTUPDATE = '1N_qX_beldGyLspfU6lgeskWd-aYu6ugAhRFTrHgO_Sw';
const SHEET_NAMELASTUPDATE = 'Import Stock';
// üëâ ‡πÉ‡∏ä‡πâ query select H limit 1 offset 0 ‚Üí ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤ H1
const API_URL_LASTUPDATE = `https://docs.google.com/spreadsheets/d/${SHEET_IDLASTUPDATE}/gviz/tq?tq=select H limit 1 offset 0&sheet=${SHEET_NAMELASTUPDATE}&tqx=out:json`;

async function fetchLastUpdate() {
  try {
    const res = await fetch(API_URL_LASTUPDATE);
    const text = await res.text();
    const json = JSON.parse(text.substring(47).slice(0, -2));

    const cell = json.table.rows[0]?.c[0];  // üëâ H1
    let formatted = "";

    if (cell?.f) {
      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ format string (Google Sheets ‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß)
      formatted = cell.f;
    } else if (cell?.v) {
      if (typeof cell.v === "string" && cell.v.startsWith("Date(")) {
        const parts = cell.v.match(/\d+/g).map(Number);
        const d = new Date(parts[0], parts[1], parts[2], parts[3]||0, parts[4]||0, parts[5]||0);
        formatted = d.toLocaleDateString('th-TH', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          timeZone: 'Asia/Bangkok'
        });
      } else {
        formatted = cell.v;
      }
    } else {
      formatted = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
    }

    document.getElementById('lastUpdate').textContent = formatted;
  } catch (err) {
    console.error("‡πÇ‡∏´‡∏•‡∏î lastUpdate ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
    document.getElementById('lastUpdate').textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
  }
}

fetchLastUpdate();
</script>

</body>
</html>
